= Fundamentals
////
FIXME: title-logo-image seems to be working only for pdf, not for html,
here only as reminder for the missing title logo.
It's not clear which source-highlighter works better, please test if needed.
////
:imagesdir: ./assets/images
:source-highlighter: rouge
:title-logo-image: image:q-logo-small.png[Q Logo]
:toc: auto

== File Structure

The library is organized with this simplified directory structure:

////
NOTE: there is a way to create a tree with asciidoc, see
https://nikostotz.de/blog/tree-in-asciidoctor.html
////

docs:: Where this documentation resides.
example:: Self-contained and easy to understand c++ programs that demonstrate various features of the library.
q_io::
external::: 3rd party libraries used by the `q_io` module.
include::: `q_io` header files.
src::: `q_io` source files.
q_lib::
include::: Header-only core `q_lib` DSP library.
test:: Contains a comprehensive set of c++ files for testing the library.

Sub-directories not listed here can be ignored.

== Namespace

All entities in the Q library are placed in namespace `cycfi::q`. Everywhere
in this documentation, we will be using a namespace alias to make the code
less verbose:

[source,c++]
----
namespace q = cycfi::q;
----

== Function Objects

In the realm of electronic music, there are _processors_ and _synthesizers_, whose definitions overlap somewhat and differ primarily in how they handle input and output. The processor receives one or more input samples and generates one or more output samples according to a specific processing algorithm. A synthesizer, on the other hand, generates sound from scratch without using any samples.


In the Q world, both _processors_ and _synthesizers_ are just _function objects_ — C++ function objects, which are basic building blocks that can be composed to form more complex functions. A function object can accept zero or more input values and generate zero or more output values.

Syntactically, you can use these functions just like any other function. For a single input function object, for example:

[source,c++]
----
float r = f(s);
----

where `s` is the input value, and `f(s)` returns a result and stores it in the variable `r`.

== Data Types

Typical audio processors in the Q DSP library work on floating point input samples with the normal -1.0 to 1.0 range. However, values are not limited to sampled signals. For instance, signal envelopes are best represented as decibels that are processed in the logarithmic domain, so dynamic-range processors such as compressors and expanders accept `decibel` as input and return `decibel` as output. For example:

[source,c++]
----
decibel gain = comp(env);
----

`comp` is a compressor. The compressor above, however, processes signal envelopes rather than raw samples, in contrast to the typical implementation of DSP compressors. The compressor above accepts an envelope represented by `decibel`, performs computation in the logarithmic domain, and returns a compressed envelope also represented by `decibel`.

Oscillators, as another example, operate on phase-angle inputs and return output samples:

[source,c++]
----
float out = sin(phase++);
----

The Q DSP library has a rich set of such types:

`float` and `double`:: Typical sample data type -1.0 to 1.0 (or beyond for some
computational headroom).
`frequency`:: Cycles per second (Hz).
`duration` :: A time span (seconds, milliseconds, etc.)
`period` :: The inverse of frequency.
`phase`:: Fixed point 1.31 format where 31 bits are fractional. `phase`.
represents 0 to 2π phase values suitable for oscillators.
`decibel`:: Ratio of one value to another on a logarithmic scale (dB).

See xref:units.adoc[Units] for further detail.

The Q DSP library is typeful and typesafe. You can not mismatch values of different types such as `frequency` and `decibel`, for example. Such potentially disastrous mistakes can happen if all values are just raw floating point types.

There are conversions to and from these data types where it is reasonable to do so. `decibel` can, for example, be converted to 'float' or 'double' using the `as_float` or `as_double` conversion functions. Example:

[source,c++]
----
float gain = as_float(12_dB);
----

Relational operations are allowed. For example:

[source,c++]
----
if (gain > 3_dB) // 3_dB is a decibel literal (see below)
   s = lp(s);
----

Arithmetic operations are allowed. For example:
[source,c++]
----
auto total_duration = 3_ms + 5_ms; // 3_ms and 5_ms are duration literals
----

Where appropriate, arithmetic with raw types are allowed. For example:

[source,c++]
----
auto harmonic = 440_Hz * 4; // 440_Hz is a frequency literal
----

== Literals

To augment the wealth of value types, the Q DSP library makes abundant use of http://tinyurl.com/yafvvb6b[user-defined literals]. We take advantage of C++ type safe user-defined literals, instead of the usual `float` or `double` which can be unsafe when values of different units (e.g. frequency vs. duration) are mismatched. The Q DSP library makes abundant use of user-defined literals for units such as time, frequency and volume. For example, we use `24_dB`, instead of a unit-less `24` or worse, a non-intuitive, unit-less `15.8` —the gain equivalent of `24_dB`. Such constants also make the code very readable, another objective of this library.

Q Literals are placed in the namespace `q::literals`. The namespace is sparse enough to be hoisted into your namespace using `using namespace`:

To use these literals, include the `literals.hpp` header:

[source,c++]
----
#include <q/support/literals.hpp>
----

then use the `literals` namespace somewhere in a scope where you need it:

[source,c++]
----
using namespace q::literals;
----

=== Examples

Here are some example expressions:

==== Frequency

[source,c++]
----
82.4069_Hz
440_Hz
1.5_KHz
1.5_kHz
1_kHz
0.5_MHz
3_MHz
----

==== Duration

[source,c++]
----
10.3_s
1_s
20.5_ms
1_ms
10.5_us
500_us
----

==== Decibel

[source,c++]
----
-3.5_dB
10_dB
----

==== Pi

[source,c++]
----
2_pi
0.5_pi
----

_Copyright (c) 2014-2023 Joel de Guzman. All rights reserved._
_Distributed under the https://opensource.org/licenses/MIT[MIT License]_
