<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using FX - Q Audio DSP Library :: Q Docs</title>
    <link rel="canonical" href="https://www.cycfi.com/q/1/using_fx.html">
    <meta name="generator" content="Antora 3.1.2">
    <link rel="stylesheet" href="../../_/css/site.css">
<meta name="og:title" content="Q Docs Q DSP Library Documentation"/>
<link rel="icon" type="image/png" sizes="16x16" href="https://cycfi.com/assets/icons/favicon-16x16.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="https://cycfi.com/assets/icons/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="96x96" href="https://cycfi.com/assets/icons/favicon-96x96.png"/>
<link rel="icon" type="image/png" sizes="192x192" href="https://cycfi.com/assets/icons/android-chrome-192x192.png"/>
<link rel="icon" type="image/png" sizes="256x256" href="https://cycfi.com/assets/icons/android-chrome-256x256.png"/>
<link rel="apple-touch-icon" type="image/png" href="https://cycfi.com/assets/icons/apple-touch-icon.png"/>

    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <!--  Cycfi Logo -->
      <a class="m-nav__logo" href="https://www.cycfi.com">
        <svg version="1.1" x="0px" y="0px" width="200" viewBox="0 0 600 100" style="padding-top: 15;" xmlns="http://www.w3.org/2000/svg">
          <g transform="matrix(2.55, 0, 0, 2.62, -464.010406, -1042.918213)" fill="#202020">
            <path d="M234.37,431.65c-0.03,0.76-0.65,1.37-1.42,1.37h-37.03c-2.34,0-4.38-0.12-6.06-0.36 c-1.78-0.25-3.29-0.7-4.47-1.32c-1.28-0.68-2.24-1.61-2.84-2.76c-0.58-1.11-0.85-2.48-0.79-4.07l0.27-7.53 c0.06-1.59,0.42-2.96,1.08-4.07c0.68-1.15,1.7-2.08,3.04-2.76c1.22-0.62,2.76-1.07,4.56-1.32c1.7-0.24,3.75-0.36,6.08-0.36h36.93 c0.8,0,1.45,0.67,1.42,1.47l-0.15,4.19c-0.03,0.76-0.65,1.37-1.42,1.37h-33.96c-1.91,0-3.5-0.04-4.6,0.08 c-1.24,0.13-1.53,0.28-1.83,0.45c-0.47,0.26-0.59,0.66-0.76,1.35c-0.14,0.84-0.18,1.03-0.19,1.43l-0.14,3.91 c-0.01,0.39,0.04,0.84,0.09,1.43c0.02,0.02,0.01,0.72,0.61,1.18c0.7,0.54,1.08,0.41,1.91,0.5c1.1,0.12,2.62,0.18,4.53,0.18h33.85 c0.8,0,1.45,0.67,1.42,1.47L234.37,431.65z"/>
            <path d="M276.06,433.02H257.9c-0.8,0-1.45-0.67-1.42-1.47l0.15-4.18c0.03-0.76,0.65-1.37,1.42-1.37h14.16 c1.91,0,3.52,0,4.61-0.12c1.23-0.13,1.75-0.25,2.17-0.71c0.36-0.39,0.4-2.52,0.4-2.52h-27.92c-11.11,0-13.26-5.13-13.1-9.44 l0.12-3.38c0.03-0.76,0.65-1.37,1.42-1.37h8.43c0.8,0,1.45,0.67,1.42,1.47l-0.05,1.36c-0.02,0.46-0.01,2.03,0.11,2.51 c0.1,0.42,0.44,0.82,0.78,1.07c0.47,0.35,0.83,0.42,1.64,0.54c0.9,0.14,2.09,0.21,3.54,0.21h24.09l0.21-5.8 c0.03-0.76,0.65-1.37,1.42-1.37h8.46c0.8,0,1.45,0.67,1.42,1.47l-0.49,13.57c-0.06,1.58-0.46,3.96-1.12,5.07 c-0.68,1.15-1.71,2.08-3.04,2.76c-1.23,0.63-2.76,1.07-4.56,1.32C280.44,432.9,278.4,433.02,276.06,433.02L276.06,433.02z"/>
            <path d="M401.95,431.55l0.78-21.72c0.03-0.76,0.65-1.37,1.42-1.37h8.59c0.8,0,1.45,0.67,1.42,1.47l-0.78,21.72 c-0.03,0.76-0.65,1.37-1.42,1.37h-8.59C402.56,433.02,401.92,432.35,401.95,431.55z"/>
            <path d="M346.77,431.65c-0.03,0.76-0.65,1.37-1.42,1.37h-37.03c-2.34,0-4.38-0.12-6.06-0.36 c-1.78-0.25-3.29-0.7-4.47-1.32c-1.28-0.68-2.24-1.61-2.84-2.76c-0.58-1.11-0.85-2.48-0.79-4.07l0.27-7.53 c0.06-1.59,0.42-2.96,1.08-4.07c0.68-1.15,1.71-2.08,3.04-2.76c1.22-0.62,2.76-1.07,4.56-1.32c1.7-0.24,3.75-0.36,6.08-0.36h36.93 c0.8,0,1.45,0.67,1.42,1.47l-0.15,4.19c-0.03,0.76-0.65,1.37-1.42,1.37h-33.96c-1.91,0-2.47-0.04-3.58,0.08 c-1.24,0.13-1.53,0.28-1.83,0.45c-0.47,0.26-0.58,0.66-0.76,1.35c-0.14,0.84-0.22,2.03-0.23,2.43l-0.07,1.91 c-0.01,0.39,0.01,1.84,0.06,2.43c0.02,0.02,0.01,0.72,0.61,1.18c0.7,0.54,1.08,0.41,1.91,0.5c1.1,0.12,2.62,0.18,4.53,0.18h32.83 c0.8,0,1.45,0.67,1.42,1.47L346.77,431.65z"/>
            <path d="M386.2,425.88l-24.93-0.03l-0.21,5.8c-0.03,0.76-0.65,1.37-1.42,1.37h-8.46c-0.8,0-1.45-0.67-1.42-1.47 l0.49-13.57c0.06-1.58,0.46-3.96,1.12-5.07c0.68-1.15,1.71-2.08,3.04-2.76c1.23-0.63,2.76-1.07,4.56-1.32 c1.7-0.24,3.75-0.36,6.08-0.36l0,0h33.68c0.8,0,1.45,0.67,1.42,1.47l-0.15,4.18c-0.03,0.76-0.65,1.37-1.42,1.37H368.9 c-1.91,0-3.52,0-4.61,0.12c-1.23,0.13-1.75,0.25-2.17,0.71c-0.36,0.39-0.4,2.52-0.4,2.52h24.63c0.8,0,1.45,0.67,1.42,1.47 l-0.15,4.22C387.59,425.28,386.96,425.88,386.2,425.88z"/>
          </g>
        </svg>
      </a>
      <a class="navbar-item" href="https://www.cycfi.com">Q Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="q" data-version="1">
  <aside class="nav">
    <div class="panels">
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Q Audio DSP Library</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="setup.html">Setup and Installation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="quick_start.html">Quick Start</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fundamentals.html">Fundamentals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="units.html">Units</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Q Audio DSP Library</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">Q Audio DSP Library</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Q Audio DSP Library</a></li>
    <li><a href="using_fx.html">Using FX - Q Audio DSP Library</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Using FX - Q Audio DSP Library</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_biquad_filters_and_delay">Biquad filters and delay</a>
<ul class="sectlevel2">
<li><a href="#_the_fx_processor">The FX processor</a></li>
<li><a href="#_the_main_function">The Main Function</a></li>
<li><a href="#_delay_effects">Delay effects</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_biquad_filters_and_delay"><a class="anchor" href="#_biquad_filters_and_delay"></a>Biquad filters and delay</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s take a look into applying some fx in real time on a test audio file. In
particular we&#8217;re going to look into some biquad highpass and lowpass filters
as well as a delay effect.
This examples are complete and self-contained in one .cpp
file, kept as simple as possible to highlight the ease-of-use.</p>
</div>
<div class="paragraph">
<p>Make sure you have a working sound system and the volume is up :)</p>
</div>
<div class="paragraph">
<p>Take note that the demo is a console application. The Q library does not have
a GUI, for good reason! We want to keep it as simple as possible. The GUI is
taken cared of by other libraries (e.g. <a href="https://github.com/cycfi/elements">Elements</a>).</p>
</div>
<div class="paragraph">
<p>There are more demo applications in the example directory. After this quick
tutorial, free to explore.</p>
</div>
<div class="sect2">
<h3 id="_the_fx_processor"><a class="anchor" href="#_the_fx_processor"></a>The FX processor</h3>
<div class="paragraph">
<p>Here&#8217;s the filter processor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">   struct filter_processor : q::port_audio_stream
   {
      filter_processor(
         q::wav_memory&amp; wav
       , q::frequency hpfFreq
       , q::frequency lpfFreq
      )
       : port_audio_stream(0, 2, wav.sps())
       , _wav(wav)
       , _hpf(hpfFreq, wav.sps())
       , _lpf(lpfFreq, wav.sps())
      {}

      void process(out_channels const&amp; out)
      {
         auto left = out[0];
         auto right = out[1];
         for (auto frame : out.frames())
         {
            // Get the next input sample
            auto s = _wav()[0];

            // Cascaded highpass and lowpass processing
            _y = _hpf(s),
            _y = _lpf(_y);

            // Output
            left[frame] = _y;
            right[frame] = _y;
         }
      }

      q::wav_memory&amp;    _wav;
      q::highpass      _hpf;
      q::lowpass       _lpf;
      float             _y = 0.0f;
   };</code></pre>
</div>
</div>
<div class="paragraph">
<p>As seen in other examples too, this is a subclass of <code>q::port_audio_stream</code>.
We setup an audio stream with the default settings and provide the output
audio stream to our processing loop (the <code>process</code> function seen above).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">   filter_processor(
      q::wav_memory&amp; wav
    , q::frequency hpfFreq
    , q::frequency lpfFreq
   )
    : port_audio_stream(0, 2, wav.sps())
    , _wav(wav)
    , _hpf(hpfFreq, wav.sps())
    , _lpf(lpfFreq, wav.sps())
   {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Moreover, we provide the class with the data of a wave file loaded from the
hard disk as well as settings for the filters, namely cutoff frequencies.
The sampling frequency is of course defined by the wave file.
The filters are initialized:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">   _hpf(hpfFreq, wav.sps())</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">   _lpf(lpfFreq, wav.sps())</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s take a closer look at the very "flesh" of our example, our process function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">   void process(out_channels const&amp; out)
   {
      auto left = out[0];
      auto right = out[1];
      for (auto frame : out.frames())
      {
         // Get the next input sample
         auto s = _wav()[0];

         // Cascaded highpass and lowpass processing
         _y = _hpf(s),
         _y = _lpf(_y);

         // Output
         left[frame] = _y;
         right[frame] = _y;
      }
   }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first two lines give us access to the audio output stream:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">   auto left = out[0];
   auto right = out[1];</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we loop through all the samples in the wave file, fetching one-by-one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">   auto s = _wav()[0];</code></pre>
</div>
</div>
<div class="paragraph">
<p>And apply our filters in cascade to the every sample:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">   _y = _hpf(s),
   _y = _lpf(_y);</code></pre>
</div>
</div>
<div class="paragraph">
<p>And finally send the processed sample off to the output stream:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">   left[frame] = _y;
   right[frame] = _y;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_main_function"><a class="anchor" href="#_the_main_function"></a>The Main Function</h3>
<div class="paragraph">
<p>In the main function, we make sure to load our test audio file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">   q::wav_memory     wav{ "audio_files/Low E.wav" };</code></pre>
</div>
</div>
<div class="paragraph">
<p>The we initialize our audio stream by providing with the wave file and some
drastic cutoff frequencies to make the result of the processing very apparent.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">   filter_processor   proc{ wav, 1_kHz, 2_kHz };</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we&#8217;re ready to start the audio stream and wait for the audio file to be played to the end.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">   if (proc.is_valid())
   {
      proc.start();
      q::sleep(q::duration(wav.length()) / wav.sps());
      proc.stop();
   }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_delay_effects"><a class="anchor" href="#_delay_effects"></a>Delay effects</h3>
<div class="paragraph">
<p>Similarly, in the delay.cpp example also found in the example folder,
we have our delay processor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">   struct delay_processor : q::port_audio_stream
   {
      delay_processor(
         q::wav_memory&amp; wav
       , q::duration delay
       , float feedback
      )
       : port_audio_stream(0, 2, wav.sps())
       , _wav(wav)
       , _delay(delay, wav.sps())
       , _feedback(feedback)
      {}

      void process(out_channels const&amp; out)
      {
         auto left = out[0];
         auto right = out[1];
         for (auto frame : out.frames())
         {
            // Get the next input sample
            auto s = _wav()[0];

            // Mix the signal and the delayed signal
            _y = s + _delay();

            // Feed back the result to the delay
            _delay.push(_y * _feedback);

            // Output
            left[frame] = s;
            right[frame] = _y;
         }
      }

      q::wav_memory&amp;    _wav;
      q::delay          _delay;
      float             _feedback;
      float             _y = 0.0f;
   };</code></pre>
</div>
</div>
<div class="paragraph">
<p>The only difference here is that we initialize a delay effect and provide
a value (between 0 to 1) to define how much feedback the delay will have:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">   _delay(delay, wav.sps())</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">   _feedback(feedback)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In our process loop we mix the current sample with the sum of delayed samples
and make sure to push the new sample to the delay stack with the defined feedback gain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">   _y = s + _delay();
   _delay.push(_y * _feedback);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the main function we make sure to initiliaze our delay processor
with the test audio file and delay and feedback parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">   delay_processor   proc{ wav, 350_ms, 0.85f };</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><em>Copyright (c) 2014-2023 Joel de Guzman. All rights reserved.</em>
<em>Distributed under the <a href="https://opensource.org/licenses/MIT">MIT License</a></em></p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
